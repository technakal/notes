# Java Persistence API

- Java Persistence API (JPA) allows you to interact with a database in your Java code, without explicitly writing select/insert/update queries.
  - In a sense, it allows you to say, "I want to get this Java object from the database" or "I want to save this object to the database", and then it handles translating that to SQL.
  - It does this through Object Relational Mapping (ORM), which involves mapping Java objects to their corresponding relational tables (and vice versa).
- Spring also offers some shortcuts to integrating JPA, through the Spring Data library.

## Overview

- JPA is a Java package for accessing, persisting, and managing data between Java objects and a relational database.
- JPA allows for contract free objects, defined through annotations or XML.

## Features of JPA

- Can perform Create, Read, Update and Delete, without using SQL.
- Can manage relationships between objects.
- Can write queries using a specialized JPA query language.

## Entities

- One of the key concepts in JPA is the Entity.
  - An entity is a lightweight persistence domain object.
  - Typically, an entity represents a table in a relational database, and each entity instance corresponds to a row in that table.
  - Entities are typically represented in Java as entity classes, though they can be helper classes too.
- The persistent state of an entity is represented through either persistent fields or persistent properties.
  - These fields or properties use object/relational mapping annotations to map the entities and entity relationships to the relational data in the underlying data store.

### Entity Requirements

- For a class to be an entity class, it must meet the following requirements:
  - Use the `javax.persistence.Entity` annotation.
  - Must have a public or protected constructor that takes no arguments.
  - It must not be final or have any final methods or fields.
  - All fields must be private, protected, or package-private.

### Persistence Fields

- Anything not annotated `Transient` or marked transient by Java will be persisted to the database.
- Object/relational mapping annotations must be applied to instance variables.

### Primary Keys

- Each entity must have a primary key.
- The primary key allows the persistence API to identify a particular instance of an entity.
- Primary keys can be simple or composite.
  - A simple key is annotated with `javax.persistence.Id`.
- Primary keys can only be applied to a field that contains a Java primitive type or Java primitive wrapper:
  - java.lang.String
  - java.util.Date
  - java.sql.Date
  - java.math.BigDecimal
  - java.math.BigInteger
- Primary keys can be auto-generated via the `AutoGenerated` annotation.
  - There are four types of supported auto-generation:
    - AUTO (default)
      - For the default generation type, the persistence provider will determine values based on the type of the primary key attribute.
      - For numeric values, the generation is based on a sequence or table generator.
      - In this case, the primary key values will be unique at the database level.
    - IDENTITY
      - Expects the corresponding database column to be set to IDENTITY and AUTO_INCREMENT.
    - SEQUENCE
      - This generator uses sequences if supported by the database or switches to table generation if it doesnâ€™t.
      - To customize the sequence name, we can use the `@GenericGenerator` annotation with `SequenceStyleGenerator` strategy.
      - This one is quite a bit different from the options above. It requires a few more configurations, and doesn't use `@AutoGenerated`.
      - The generated values are unique per sequence.
      - If a sequence name is not specified, Hibernate will re-use the same hibernate_sequence for different types.
    - TABLE
      - The `TableGenerator` uses an underlying database table that holds segments of identifier generation values.

```java
// AUTO
@Entity
public class MyFirstEntity {

  @Id
  @AutoGenerated
  private Long id;

}

// IDENTITY
@Entity
public class MyFirstEntity {

  @Id
  @AutoGenerated(strategy = GenerationType.IDENTITY)
  private Long id;

}

// SEQUENCE
@Entity
public class MyFirstEntity {

  @Id
  @GeneratedValue(generator = "sequence-generator")
  @GenericGenerator(
    name: "sequence-generator",
    strategy = "org.hibernate.id.enhanced.SequenceStyleGenerator",
    parameters = {
      @Parameter(name = "sequence_name", value = "user_sequence"),
      @Parameter(name = "initial_value", value = "4"),
      @Parameter(name = "increment_size", value = "1")
    }
  )
  private Long id;

}

// TABLE
@Entity
public class MyFirstEntity {

  @Id
  @GeneratedValue(strategy = GenerationType.TABLE,
    generator = "table-generator")
  @TableGenerator(name = "table-generator",
    table = "dep_ids",
    pkColumnName = "seq_id",
    valueColumnName = "seq_value")
  private Long orderId;

}
```
